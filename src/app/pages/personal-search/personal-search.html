<div class="p-4 max-w-xl mx-auto">
  <h2 class="text-2xl font-bold mb-4">Tra cá»©u thÃ´ng tin</h2>

  <!-- Nháº­p Cccd hoáº·c MST -->
  <div class="mb-4 flex gap-2">
    <input [(ngModel)]="query" placeholder="Nháº­p Cccd (12 sá»‘) hoáº·c MST (10 sá»‘)" class="flex-1 border p-2 rounded" />
    <button (click)="onSearch()" class="bg-blue-600 text-white px-4 py-2 rounded" [disabled]="loading">
      ğŸ” Tra cá»©u
    </button>
  </div>

  <!-- Tráº¡ng thÃ¡i -->
  <div *ngIf="loading" class="text-gray-500 mb-2 font-semibold">
    â³ Äang tÃ¬m kiáº¿m...
  </div>
  <div *ngIf="error" class="text-red-500 mb-2">{{ error }}</div>

  <!-- Káº¿t quáº£ -->
  <div *ngIf="result" class="mt-4 p-4 border rounded bg-gray-50">
    <p><b>TÃªn:</b> {{ result?.data?.name }}</p>
    <p><b>MST:</b> {{ result?.data?.taxId }}</p>
    <p><b>Äá»‹a chá»‰:</b>
      <span *ngIf="!editingAddress">{{ result?.data?.address }}</span>
      <input *ngIf="editingAddress" [(ngModel)]="newAddress" class="border p-1 rounded" />
      <button (click)="toggleEditAddress()" class="ml-2 px-2 py-1 bg-yellow-400 text-white rounded">
        {{ editingAddress ? 'Há»§y' : 'Chá»‰nh sá»­a' }}
      </button>
      <button *ngIf="editingAddress" (click)="saveAddress()" class="ml-2 px-2 py-1 bg-green-600 text-white rounded">
        LÆ°u
      </button>
    </p>
    <p><b>Tráº¡ng thÃ¡i:</b> {{ result?.data?.status }}</p>
  </div>

  <p><b>Nguá»“n dá»¯ liá»‡u:</b> {{ result?.source }}</p>

  <!-- Chatbot thu nhá» -->
  <div class="fixed bottom-4 right-4 w-80">
    <button (click)="toggleChat()" class="bg-blue-600 text-white px-3 py-2 rounded-full shadow">
      ğŸ’¬ Chat
    </button>

    <div *ngIf="chatOpen" class="mt-2 border rounded bg-white shadow-lg flex flex-col h-96">
      <div class="flex-1 p-2 overflow-y-auto flex flex-col gap-2">
        <div *ngFor="let msg of messages" [ngClass]="{
               'self-end bg-blue-100 text-right': msg.startsWith('Báº¡n:'),
               'self-start bg-gray-100 text-left': !msg.startsWith('Báº¡n:')
             }" class="p-2 rounded max-w-xs break-words whitespace-pre-wrap">
          {{ msg }}
        </div>
      </div>
      <div class="flex border-t border-gray-200 p-2 gap-2">
        <input [(ngModel)]="chatInput" type="text" placeholder="Nháº­p tin nháº¯n..."
          class="flex-1 border p-2 rounded focus:outline-none focus:ring focus:ring-blue-300"
          (keydown.enter)="sendMessage()" />
        <button (click)="sendMessage()" class="bg-blue-600 text-white px-4 rounded">Gá»­i</button>
      </div>
    </div>

    <app-chatbot-search #chatbotLogic></app-chatbot-search>
  </div>
</div>